<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>src/f90/mod/ssht_dl_mod.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Types&nbsp;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c7a17dbb9c7301c0cf24a41ffb6eb7fb.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_d8ecbefe5f4c5fc7165aeaa37f1b40b6.html">f90</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_db907d8db6555ecba9db2c0f0c3a4d2a.html">mod</a>
  </div>
</div>
<div class="contents">
<h1>ssht_dl_mod.f90</h1><a href="ssht__dl__mod_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">! SSHT package to perform spin spherical harmonic transforms</span>
<a name="l00002"></a>00002 <span class="comment">! Copyright (C) 2011  Jason McEwen</span>
<a name="l00003"></a>00003 <span class="comment">! See LICENSE.txt for license details</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="comment">! ssht_dl_mod</span>
<a name="l00008"></a>00008 <span class="comment">!</span>
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="namespacessht__dl__mod.html">00017</a> <span class="keyword">module</span> ssht_dl_mod
<a name="l00018"></a>00018 
<a name="l00019"></a>00019   use <span class="keywordflow">ssht_types_mod</span>, only: dp, SQRT2, PION2
<a name="l00020"></a>00020   use <span class="keywordflow">ssht_error_mod</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022   <span class="keyword">implicit none</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024   <span class="keywordtype">private</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   
<a name="l00027"></a>00027   <span class="comment">!---------------------------------------</span>
<a name="l00028"></a>00028   <span class="comment">! Subroutine and function scope</span>
<a name="l00029"></a>00029   <span class="comment">!---------------------------------------</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031   <span class="keywordtype">public</span> :: &amp;
<a name="l00032"></a>00032        <a class="code" href="namespacessht__dl__mod.html#aa0d2c93c3a04508c4063fa125655a060">ssht_dl_beta_operator</a>, &amp;
<a name="l00033"></a>00033        <a class="code" href="namespacessht__dl__mod.html#a08f038cdccc9584dd17cb0fb53036ead">ssht_dl_beta_risbo_full</a>, &amp;
<a name="l00034"></a>00034        <a class="code" href="namespacessht__dl__mod.html#a6a96c3fe1303e5a71759deaf2bb09357">ssht_dl_beta_risbo_full_table</a>, &amp;
<a name="l00035"></a>00035        <a class="code" href="namespacessht__dl__mod.html#a3a983cea62531b08c2023137f11b80c9">ssht_dl_beta_risbo_half_table</a>, &amp;
<a name="l00036"></a>00036        <a class="code" href="namespacessht__dl__mod.html#ac5ceb5c9446f7a86fba5c9cdbde04726">ssht_dl_beta_risbo_fill_half2full</a>, &amp;
<a name="l00037"></a>00037        <a class="code" href="namespacessht__dl__mod.html#a8db3e2a5a0d199197cc952e90d9f662f">ssht_dl_halfpi_trapani_eighth</a>, &amp;
<a name="l00038"></a>00038        <a class="code" href="namespacessht__dl__mod.html#a686f1baf763676c1cd74c7f654646cb8">ssht_dl_halfpi_trapani_eighth_table</a>, &amp;
<a name="l00039"></a>00039        <a class="code" href="namespacessht__dl__mod.html#ad015dc242ed6e09f8ebe8ed7353ee137">ssht_dl_halfpi_trapani_fill_eighth2full</a>, &amp;
<a name="l00040"></a>00040        <a class="code" href="namespacessht__dl__mod.html#adfc0c434c2a7b054b5707eb356aabcf2">ssht_dl_halfpi_trapani_fill_eighth2full_table</a>, &amp;
<a name="l00041"></a>00041        <a class="code" href="namespacessht__dl__mod.html#a55d35ee6e482d64090ea74f7f94c81ac">ssht_dl_halfpi_trapani_fill_eighth2tophalf</a>, &amp;
<a name="l00042"></a>00042        <a class="code" href="namespacessht__dl__mod.html#a3a71d3e987f807132a8a57978b5f4852">ssht_dl_halfpi_trapani_fill_eighth2tophalf_table</a>, &amp;
<a name="l00043"></a>00043        <a class="code" href="namespacessht__dl__mod.html#a025eb6f5d17b61151b059744cbf08f82">ssht_dl_halfpi_trapani_fill_eighth2righthalf</a>, &amp;
<a name="l00044"></a>00044        <a class="code" href="namespacessht__dl__mod.html#a1649263883d2c81c5d2e0a1dfb40361e">ssht_dl_halfpi_trapani_fill_eighth2righthalf_table</a>, &amp;
<a name="l00045"></a>00045        <a class="code" href="namespacessht__dl__mod.html#a4d4bd52c8600abece770cb172fb6788a">ssht_dl_halfpi_trapani_fill_eighth2quarter</a>, &amp;
<a name="l00046"></a>00046        <a class="code" href="namespacessht__dl__mod.html#adc8f56f6411b454152d8649e8b67e023">ssht_dl_halfpi_trapani_fill_eighth2quarter_table</a>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <span class="comment">!----------------------------------------------------------------------------</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   <span class="keyword">contains</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00055"></a>00055     <span class="comment">! Risbo&#39;s method</span>
<a name="l00056"></a>00056     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00059"></a>00059     <span class="comment">! ssht_dl_beta_risbo_full</span>
<a name="l00060"></a>00060     <span class="comment">!</span>
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="namespacessht__dl__mod.html#a08f038cdccc9584dd17cb0fb53036ead">00077</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a08f038cdccc9584dd17cb0fb53036ead">ssht_dl_beta_risbo_full</a>(dl, beta, l)
<a name="l00078"></a>00078 
<a name="l00079"></a>00079       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l00080"></a>00080       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(out)</span> :: dl(-l:l,-l:l)
<a name="l00081"></a>00081       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: beta
<a name="l00082"></a>00082 
<a name="l00083"></a>00083       <span class="keywordtype">integer</span> :: sign, i, j, k, m, mm
<a name="l00084"></a>00084       <span class="keywordtype">real(kind = dp) </span>:: sinb, cosb, sinhb, coshb, rj, dlj, ddj
<a name="l00085"></a>00085       <span class="keywordtype">real(kind = dp) </span>:: sqrt_jmk, sqrt_kp1, sqrt_jmi, sqrt_ip1
<a name="l00086"></a>00086       <span class="keywordtype">real(kind=dp) </span>:: dd(0: 2 * l + 1, 0: 2 * l + 1)
<a name="l00087"></a>00087 
<a name="l00088"></a>00088       <span class="keyword">if</span> (l &lt; 0) <span class="keyword">then</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090          call <a class="code" href="namespacessht__error__mod.html#ab9c297719b0acfce921d32866ddc2b42">ssht_error</a>(<a class="code" href="namespacessht__error__mod.html#a1c0ea360f1aedd24dc9cecf64952f426">SSHT_ERROR_ARG_INVALID</a>, <span class="stringliteral">&#39;ssht_dl_beta_recursion&#39;</span>, &amp;
<a name="l00091"></a>00091               comment_add=<span class="stringliteral">&#39;el &lt; 0&#39;</span>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093       <span class="comment">! For the special cases of l = 0 use the direct formula.</span>
<a name="l00094"></a>00094       <span class="keyword">else</span> <span class="keyword">if</span> (l == 0) <span class="keyword">then</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096          dl(0, 0) = 1.0_dp
<a name="l00097"></a>00097 
<a name="l00098"></a>00098       <span class="comment">! For the special cases of l = 1 use the direct formula.</span>
<a name="l00099"></a>00099       <span class="keyword">else</span> <span class="keyword">if</span> (l == 1) <span class="keyword">then</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101          <span class="comment">! These formulae are taken directly from Brink &amp; Satchler.</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103          cosb = cos(beta)
<a name="l00104"></a>00104          sinb = sin(beta)
<a name="l00105"></a>00105 
<a name="l00106"></a>00106          coshb = cos(beta / 2.0)
<a name="l00107"></a>00107          sinhb = sin(beta / 2.0)
<a name="l00108"></a>00108 
<a name="l00109"></a>00109          dl(- 1, - 1) = coshb**2
<a name="l00110"></a>00110          dl(- 1, 0) = sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00111"></a>00111          dl(- 1, 1) = sinhb**2
<a name="l00112"></a>00112 
<a name="l00113"></a>00113          dl(0, - 1) = - sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00114"></a>00114          dl(0, 0) = cosb
<a name="l00115"></a>00115          dl(0, 1) = sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117          dl(1, - 1) = sinhb**2
<a name="l00118"></a>00118          dl(1, 0) = - sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00119"></a>00119          dl(1, 1) = coshb**2
<a name="l00120"></a>00120 
<a name="l00121"></a>00121       <span class="keyword">else</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123          sinhb = sin(beta / 2.0) <span class="comment">! p</span>
<a name="l00124"></a>00124          coshb = - cos(beta / 2.0) <span class="comment">!-q</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126          <span class="comment">! Initialise the plane of the dl-matrix to 0.0 for the recursion</span>
<a name="l00127"></a>00127          <span class="comment">! from l - 1 to l - 1/2.</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129          dd(0: 2 * l + 1, 0: 2 * l + 1) = 0.0_dp
<a name="l00130"></a>00130 
<a name="l00131"></a>00131          j = 2 * l - 1
<a name="l00132"></a>00132          rj = <span class="keywordtype">real</span>(j)
<a name="l00133"></a>00133          <span class="keyword">do</span> k = 0, j - 1
<a name="l00134"></a>00134             sqrt_jmk = dsqrt(<span class="keywordtype">real</span>(j-k,kind=dp))
<a name="l00135"></a>00135             sqrt_kp1 = dsqrt(<span class="keywordtype">real</span>(k+1,kind=dp))
<a name="l00136"></a>00136             <span class="keyword">do</span> i = 0, j - 1
<a name="l00137"></a>00137                sqrt_jmi = dsqrt(<span class="keywordtype">real</span>(j-i,kind=dp))
<a name="l00138"></a>00138                sqrt_ip1 = dsqrt(<span class="keywordtype">real</span>(i+1,kind=dp))
<a name="l00139"></a>00139                dlj = dl(k - (l - 1), i - (l - 1)) / rj
<a name="l00140"></a>00140                dd(i, k) = dd(i, k) &amp;
<a name="l00141"></a>00141                     + sqrt_jmi * sqrt_jmk * dlj * coshb
<a name="l00142"></a>00142                dd(i + 1, k) = dd(i + 1, k) &amp;
<a name="l00143"></a>00143                     - sqrt_ip1 * sqrt_jmk * dlj * sinhb
<a name="l00144"></a>00144                dd(i, k + 1) = dd(i, k + 1) &amp;
<a name="l00145"></a>00145                     + sqrt_jmi * sqrt_kp1 * dlj * sinhb
<a name="l00146"></a>00146                dd(i + 1, k + 1) = dd(i + 1, k + 1) &amp;
<a name="l00147"></a>00147                     + sqrt_ip1 * sqrt_kp1 * dlj * coshb
<a name="l00148"></a>00148             <span class="keyword">end do</span>
<a name="l00149"></a>00149          <span class="keyword">end do</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151          <span class="comment">! Having constructed the d^(l+1/2) matrix in dd, do the second</span>
<a name="l00152"></a>00152          <span class="comment">! half-step recursion from dd to dl. Start by initilalising  </span>
<a name="l00153"></a>00153          <span class="comment">! the plane of the dl-matrix to 0.0.</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155          dl(- l: l, - l: l) = 0.0_dp
<a name="l00156"></a>00156 
<a name="l00157"></a>00157          j = 2 * l
<a name="l00158"></a>00158          rj = <span class="keywordtype">real</span>(j)
<a name="l00159"></a>00159          <span class="keyword">do</span> k = 0, j - 1
<a name="l00160"></a>00160             sqrt_jmk = dsqrt(<span class="keywordtype">real</span>(j-k,kind=dp))
<a name="l00161"></a>00161             sqrt_kp1 = dsqrt(<span class="keywordtype">real</span>(k+1,kind=dp))
<a name="l00162"></a>00162             <span class="keyword">do</span> i = 0, j - 1
<a name="l00163"></a>00163                sqrt_jmi = dsqrt(<span class="keywordtype">real</span>(j-i,kind=dp))
<a name="l00164"></a>00164                sqrt_ip1 = dsqrt(<span class="keywordtype">real</span>(i+1,kind=dp))
<a name="l00165"></a>00165                ddj = dd(i, k) / rj
<a name="l00166"></a>00166                dl(k - l, i - l) = dl(k - l, i - l) &amp;
<a name="l00167"></a>00167                     + sqrt_jmi * sqrt_jmk * ddj * coshb
<a name="l00168"></a>00168                dl(k - l, i + 1 - l) = dl(k - l, i + 1 - l) &amp;
<a name="l00169"></a>00169                     - sqrt_ip1 * sqrt_jmk * ddj * sinhb
<a name="l00170"></a>00170                dl(k + 1 - l, i - l) = dl(k + 1 - l, i - l) &amp;
<a name="l00171"></a>00171                     + sqrt_jmi * sqrt_kp1 * ddj * sinhb
<a name="l00172"></a>00172                dl(k + 1 - l, i + 1 - l) = dl(k + 1 - l, i + 1 - l) &amp;
<a name="l00173"></a>00173                     + sqrt_ip1 * sqrt_kp1 * ddj * coshb
<a name="l00174"></a>00174             <span class="keyword">end do</span>
<a name="l00175"></a>00175          <span class="keyword">end do</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177       <span class="keyword">end if</span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="keyword">    end subroutine ssht_dl_beta_risbo_full</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00183"></a>00183     <span class="comment">! ssht_dl_beta_risbo_full_table</span>
<a name="l00184"></a>00184     <span class="comment">!</span>
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="namespacessht__dl__mod.html#a6a96c3fe1303e5a71759deaf2bb09357">00204</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a6a96c3fe1303e5a71759deaf2bb09357">ssht_dl_beta_risbo_full_table</a>(dl, beta, l, sqrt_tbl)
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l00207"></a>00207       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(out)</span> :: dl(-l:l,-l:l)
<a name="l00208"></a>00208       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: beta
<a name="l00209"></a>00209       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: sqrt_tbl(0:2*l)
<a name="l00210"></a>00210 
<a name="l00211"></a>00211       <span class="keywordtype">integer</span> :: sign, i, j, k, m, mm
<a name="l00212"></a>00212       <span class="keywordtype">real(kind = dp) </span>:: sinb, cosb, sinhb, coshb, rj, dlj, ddj
<a name="l00213"></a>00213       <span class="keywordtype">real(kind = dp) </span>:: sqrt_jmk, sqrt_kp1, sqrt_jmi, sqrt_ip1
<a name="l00214"></a>00214       <span class="keywordtype">real(kind=dp) </span>:: dd(0: 2 * l + 1, 0: 2 * l + 1)
<a name="l00215"></a>00215 
<a name="l00216"></a>00216       <span class="keyword">if</span> (l &lt; 0) <span class="keyword">then</span>
<a name="l00217"></a>00217 
<a name="l00218"></a>00218          call <a class="code" href="namespacessht__error__mod.html#ab9c297719b0acfce921d32866ddc2b42">ssht_error</a>(<a class="code" href="namespacessht__error__mod.html#a1c0ea360f1aedd24dc9cecf64952f426">SSHT_ERROR_ARG_INVALID</a>, <span class="stringliteral">&#39;ssht_dl_beta_recursion&#39;</span>, &amp;
<a name="l00219"></a>00219               comment_add=<span class="stringliteral">&#39;el &lt; 0&#39;</span>);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       <span class="comment">! For the special cases of l = 0 use the direct formula.</span>
<a name="l00222"></a>00222       <span class="keyword">else</span> <span class="keyword">if</span> (l == 0) <span class="keyword">then</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224          dl(0, 0) = 1.0_dp
<a name="l00225"></a>00225 
<a name="l00226"></a>00226       <span class="comment">! For the special cases of l = 1 use the direct formula.</span>
<a name="l00227"></a>00227       <span class="keyword">else</span> <span class="keyword">if</span> (l == 1) <span class="keyword">then</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229          <span class="comment">! These formulae are taken directly from Brink &amp; Satchler.</span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231          cosb = cos(beta)
<a name="l00232"></a>00232          sinb = sin(beta)
<a name="l00233"></a>00233 
<a name="l00234"></a>00234          coshb = cos(beta / 2.0)
<a name="l00235"></a>00235          sinhb = sin(beta / 2.0)
<a name="l00236"></a>00236 
<a name="l00237"></a>00237          dl(- 1, - 1) = coshb**2
<a name="l00238"></a>00238          dl(- 1, 0) = sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00239"></a>00239          dl(- 1, 1) = sinhb**2
<a name="l00240"></a>00240 
<a name="l00241"></a>00241          dl(0, - 1) = - sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00242"></a>00242          dl(0, 0) = cosb
<a name="l00243"></a>00243          dl(0, 1) = sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245          dl(1, - 1) = sinhb**2
<a name="l00246"></a>00246          dl(1, 0) = - sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00247"></a>00247          dl(1, 1) = coshb**2
<a name="l00248"></a>00248 
<a name="l00249"></a>00249       <span class="keyword">else</span>
<a name="l00250"></a>00250 
<a name="l00251"></a>00251          sinhb = sin(beta / 2.0) <span class="comment">! p</span>
<a name="l00252"></a>00252          coshb = - cos(beta / 2.0) <span class="comment">!-q</span>
<a name="l00253"></a>00253 
<a name="l00254"></a>00254          <span class="comment">! Initialise the plane of the dl-matrix to 0.0 for the recursion</span>
<a name="l00255"></a>00255          <span class="comment">! from l - 1 to l - 1/2.</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257          dd(0: 2 * l + 1, 0: 2 * l + 1) = 0.0_dp
<a name="l00258"></a>00258 
<a name="l00259"></a>00259          j = 2 * l - 1
<a name="l00260"></a>00260          rj = <span class="keywordtype">real</span>(j)
<a name="l00261"></a>00261          <span class="keyword">do</span> k = 0, j - 1
<a name="l00262"></a>00262             <span class="keyword">do</span> i = 0, j - 1
<a name="l00263"></a>00263                dlj = dl(k - (l - 1), i - (l - 1)) / rj
<a name="l00264"></a>00264                dd(i, k) = dd(i, k) &amp;
<a name="l00265"></a>00265                     + sqrt_tbl(j-i) * sqrt_tbl(j-k) * dlj * coshb
<a name="l00266"></a>00266                dd(i + 1, k) = dd(i + 1, k) &amp;
<a name="l00267"></a>00267                     - sqrt_tbl(i+1) * sqrt_tbl(j-k) * dlj * sinhb
<a name="l00268"></a>00268                dd(i, k + 1) = dd(i, k + 1) &amp;
<a name="l00269"></a>00269                     + sqrt_tbl(j-i) * sqrt_tbl(k+1) * dlj * sinhb
<a name="l00270"></a>00270                dd(i + 1, k + 1) = dd(i + 1, k + 1) &amp;
<a name="l00271"></a>00271                     + sqrt_tbl(i+1) * sqrt_tbl(k+1) * dlj * coshb
<a name="l00272"></a>00272             <span class="keyword">end do</span>
<a name="l00273"></a>00273          <span class="keyword">end do</span>
<a name="l00274"></a>00274 
<a name="l00275"></a>00275          <span class="comment">! Having constructed the d^(l+1/2) matrix in dd, do the second</span>
<a name="l00276"></a>00276          <span class="comment">! half-step recursion from dd to dl. Start by initilalising  </span>
<a name="l00277"></a>00277          <span class="comment">! the plane of the dl-matrix to 0.0.</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279          dl(- l: l, - l: l) = 0.0_dp
<a name="l00280"></a>00280 
<a name="l00281"></a>00281          j = 2 * l
<a name="l00282"></a>00282          rj = <span class="keywordtype">real</span>(j)
<a name="l00283"></a>00283          <span class="keyword">do</span> k = 0, j - 1
<a name="l00284"></a>00284             <span class="keyword">do</span> i = 0, j - 1
<a name="l00285"></a>00285                ddj = dd(i, k) / rj
<a name="l00286"></a>00286                dl(k - l, i - l) = dl(k - l, i - l) &amp;
<a name="l00287"></a>00287                     + sqrt_tbl(j-i) * sqrt_tbl(j-k) * ddj * coshb
<a name="l00288"></a>00288                dl(k - l, i + 1 - l) = dl(k - l, i + 1 - l) &amp;
<a name="l00289"></a>00289                     - sqrt_tbl(i+1) * sqrt_tbl(j-k) * ddj * sinhb
<a name="l00290"></a>00290                dl(k + 1 - l, i - l) = dl(k + 1 - l, i - l) &amp;
<a name="l00291"></a>00291                     + sqrt_tbl(j-i) * sqrt_tbl(k+1) * ddj * sinhb
<a name="l00292"></a>00292                dl(k + 1 - l, i + 1 - l) = dl(k + 1 - l, i + 1 - l) &amp;
<a name="l00293"></a>00293                     + sqrt_tbl(i+1) * sqrt_tbl(k+1) * ddj * coshb
<a name="l00294"></a>00294             <span class="keyword">end do</span>
<a name="l00295"></a>00295          <span class="keyword">end do</span>
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       <span class="keyword">end if</span>
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="keyword">    end subroutine ssht_dl_beta_risbo_full_table</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00303"></a>00303     <span class="comment">! ssht_dl_beta_risbo_half_table</span>
<a name="l00304"></a>00304     <span class="comment">!</span>
<a name="l00324"></a>00324 
<a name="l00325"></a><a class="code" href="namespacessht__dl__mod.html#a3a983cea62531b08c2023137f11b80c9">00325</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a3a983cea62531b08c2023137f11b80c9">ssht_dl_beta_risbo_half_table</a>(dl, beta, l, sqrt_tbl)
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l00328"></a>00328       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(out)</span> :: dl(-l:l,-l:l)
<a name="l00329"></a>00329       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: beta
<a name="l00330"></a>00330       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: sqrt_tbl(0:2*l)
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       <span class="keywordtype">integer</span> :: sign, i, j, k, m, mm
<a name="l00333"></a>00333       <span class="keywordtype">real(kind = dp) </span>:: sinb, cosb, sinhb, coshb, rj, dlj, ddj
<a name="l00334"></a>00334       <span class="keywordtype">real(kind = dp) </span>:: sqrt_jmk, sqrt_kp1, sqrt_jmi, sqrt_ip1
<a name="l00335"></a>00335       <span class="keywordtype">real(kind=dp) </span>:: dd(0: 2 * l + 1, 0: 2 * l + 1)
<a name="l00336"></a>00336 
<a name="l00337"></a>00337       <span class="keyword">if</span> (l &lt; 0) <span class="keyword">then</span>
<a name="l00338"></a>00338 
<a name="l00339"></a>00339          call <a class="code" href="namespacessht__error__mod.html#ab9c297719b0acfce921d32866ddc2b42">ssht_error</a>(<a class="code" href="namespacessht__error__mod.html#a1c0ea360f1aedd24dc9cecf64952f426">SSHT_ERROR_ARG_INVALID</a>, <span class="stringliteral">&#39;ssht_dl_beta_recursion&#39;</span>, &amp;
<a name="l00340"></a>00340               comment_add=<span class="stringliteral">&#39;el &lt; 0&#39;</span>);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342       <span class="comment">! For the special cases of l = 0 use the direct formula.</span>
<a name="l00343"></a>00343       <span class="keyword">else</span> <span class="keyword">if</span> (l == 0) <span class="keyword">then</span>
<a name="l00344"></a>00344 
<a name="l00345"></a>00345          dl(0, 0) = 1.0_dp
<a name="l00346"></a>00346 
<a name="l00347"></a>00347       <span class="comment">! For the special cases of l = 1 use the direct formula.</span>
<a name="l00348"></a>00348       <span class="keyword">else</span> <span class="keyword">if</span> (l == 1) <span class="keyword">then</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350          <span class="comment">! These formulae are taken directly from Brink &amp; Satchler.</span>
<a name="l00351"></a>00351 
<a name="l00352"></a>00352          cosb = cos(beta)
<a name="l00353"></a>00353          sinb = sin(beta)
<a name="l00354"></a>00354 
<a name="l00355"></a>00355          coshb = cos(beta / 2.0)
<a name="l00356"></a>00356          sinhb = sin(beta / 2.0)
<a name="l00357"></a>00357 
<a name="l00358"></a>00358          dl(- 1, - 1) = coshb**2
<a name="l00359"></a>00359          dl(- 1, 0) = sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00360"></a>00360          dl(- 1, 1) = sinhb**2
<a name="l00361"></a>00361 
<a name="l00362"></a>00362          dl(0, - 1) = - sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00363"></a>00363          dl(0, 0) = cosb
<a name="l00364"></a>00364          dl(0, 1) = sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00365"></a>00365 
<a name="l00366"></a>00366          dl(1, - 1) = sinhb**2
<a name="l00367"></a>00367          dl(1, 0) = - sinb / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a>
<a name="l00368"></a>00368          dl(1, 1) = coshb**2
<a name="l00369"></a>00369 
<a name="l00370"></a>00370       <span class="keyword">else</span>
<a name="l00371"></a>00371 
<a name="l00372"></a>00372          sinhb = sin(beta / 2.0) <span class="comment">! p</span>
<a name="l00373"></a>00373          coshb = - cos(beta / 2.0) <span class="comment">!-q</span>
<a name="l00374"></a>00374 
<a name="l00375"></a>00375          <span class="comment">! Initialise the plane of the dl-matrix to 0.0 for the recursion</span>
<a name="l00376"></a>00376          <span class="comment">! from l - 1 to l - 1/2.</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378          dd(0: 2 * l + 1, 0: 2 * l + 1) = 0.0_dp
<a name="l00379"></a>00379 
<a name="l00380"></a>00380          j = 2 * l - 1
<a name="l00381"></a>00381          rj = <span class="keywordtype">real</span>(j)
<a name="l00382"></a>00382          <span class="keyword">do</span> k = 0, j - 1
<a name="l00383"></a>00383             <span class="keyword">do</span> i = 0, l <span class="comment">!j/2 + 1</span>
<a name="l00384"></a>00384                dlj = dl(k - (l - 1), i - (l - 1)) / rj
<a name="l00385"></a>00385                dd(i, k) = dd(i, k) &amp;
<a name="l00386"></a>00386                     + sqrt_tbl(j-i) * sqrt_tbl(j-k) * dlj * coshb
<a name="l00387"></a>00387                dd(i + 1, k) = dd(i + 1, k) &amp;
<a name="l00388"></a>00388                     - sqrt_tbl(i+1) * sqrt_tbl(j-k) * dlj * sinhb
<a name="l00389"></a>00389                dd(i, k + 1) = dd(i, k + 1) &amp;
<a name="l00390"></a>00390                     + sqrt_tbl(j-i) * sqrt_tbl(k+1) * dlj * sinhb
<a name="l00391"></a>00391                dd(i + 1, k + 1) = dd(i + 1, k + 1) &amp;
<a name="l00392"></a>00392                     + sqrt_tbl(i+1) * sqrt_tbl(k+1) * dlj * coshb
<a name="l00393"></a>00393             <span class="keyword">end do</span>
<a name="l00394"></a>00394          <span class="keyword">end do</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396          <span class="comment">! Having constructed the d^(l+1/2) matrix in dd, do the second</span>
<a name="l00397"></a>00397          <span class="comment">! half-step recursion from dd to dl. Start by initilalising  </span>
<a name="l00398"></a>00398          <span class="comment">! the plane of the dl-matrix to 0.0.</span>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400          dl(- l: l, - l: l) = 0.0_dp
<a name="l00401"></a>00401 
<a name="l00402"></a>00402          j = 2 * l
<a name="l00403"></a>00403          rj = <span class="keywordtype">real</span>(j)
<a name="l00404"></a>00404          <span class="keyword">do</span> k = 0, j - 1
<a name="l00405"></a>00405             <span class="keyword">do</span> i = 0, l <span class="comment">!j/2</span>
<a name="l00406"></a>00406                ddj = dd(i, k) / rj
<a name="l00407"></a>00407                dl(k - l, i - l) = dl(k - l, i - l) &amp;
<a name="l00408"></a>00408                     + sqrt_tbl(j-i) * sqrt_tbl(j-k) * ddj * coshb
<a name="l00409"></a>00409                dl(k - l, i + 1 - l) = dl(k - l, i + 1 - l) &amp;
<a name="l00410"></a>00410                     - sqrt_tbl(i+1) * sqrt_tbl(j-k) * ddj * sinhb
<a name="l00411"></a>00411                dl(k + 1 - l, i - l) = dl(k + 1 - l, i - l) &amp;
<a name="l00412"></a>00412                     + sqrt_tbl(j-i) * sqrt_tbl(k+1) * ddj * sinhb
<a name="l00413"></a>00413                dl(k + 1 - l, i + 1 - l) = dl(k + 1 - l, i + 1 - l) &amp;
<a name="l00414"></a>00414                     + sqrt_tbl(i+1) * sqrt_tbl(k+1) * ddj * coshb
<a name="l00415"></a>00415             <span class="keyword">end do</span>
<a name="l00416"></a>00416          <span class="keyword">end do</span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       <span class="keyword">end if</span>
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 <span class="keyword">    end subroutine ssht_dl_beta_risbo_half_table</span>
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00424"></a>00424     <span class="comment">! ssht_dl_beta_risbo_fill_half2full</span>
<a name="l00425"></a>00425     <span class="comment">!</span>
<a name="l00438"></a>00438 
<a name="l00439"></a><a class="code" href="namespacessht__dl__mod.html#ac5ceb5c9446f7a86fba5c9cdbde04726">00439</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#ac5ceb5c9446f7a86fba5c9cdbde04726">ssht_dl_beta_risbo_fill_half2full</a>(dl, l)
<a name="l00440"></a>00440 
<a name="l00441"></a>00441       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l00442"></a>00442       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-l:l,-l:l)
<a name="l00443"></a>00443 
<a name="l00444"></a>00444       <span class="keywordtype">integer</span> :: m, mm
<a name="l00445"></a>00445 
<a name="l00446"></a>00446       <span class="comment">! Symmetry through origin.</span>
<a name="l00447"></a>00447       <span class="keyword">do</span> m = -l, l
<a name="l00448"></a>00448          <span class="keyword">do</span> mm = 1, l
<a name="l00449"></a>00449             dl(m,mm) = (-1)**(m+mm) * dl(-m,-mm)
<a name="l00450"></a>00450          <span class="keyword">end do</span>
<a name="l00451"></a>00451       <span class="keyword">end do</span>
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="keyword">    end subroutine ssht_dl_beta_risbo_fill_half2full</span>
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00457"></a>00457     <span class="comment">! Trapani &amp; Navaza&#39;s method</span>
<a name="l00458"></a>00458     <span class="comment">!--------------------------------------------------------------------------    </span>
<a name="l00459"></a>00459     
<a name="l00460"></a>00460     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00461"></a>00461     <span class="comment">! ssht_dl_halfpi_trapani_eighth</span>
<a name="l00462"></a>00462     <span class="comment">!</span>
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="namespacessht__dl__mod.html#a8db3e2a5a0d199197cc952e90d9f662f">00478</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a8db3e2a5a0d199197cc952e90d9f662f">ssht_dl_halfpi_trapani_eighth</a>(dl, el)
<a name="l00479"></a>00479 
<a name="l00480"></a>00480       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00481"></a>00481       <span class="keywordtype">real(dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-el:el,-el:el)
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       <span class="keywordtype">real(dp) </span>:: dmm(0:el)
<a name="l00484"></a>00484       <span class="keywordtype">integer</span> :: m, mm
<a name="l00485"></a>00485       <span class="keywordtype">real(dp) </span>:: t1, t2
<a name="l00486"></a>00486 
<a name="l00487"></a>00487       <span class="keyword">if</span> (el == 0) <span class="keyword">then</span>
<a name="l00488"></a>00488 
<a name="l00489"></a>00489          dl(0,0) = 1d0
<a name="l00490"></a>00490 
<a name="l00491"></a>00491       <span class="keyword">else</span>
<a name="l00492"></a>00492 
<a name="l00493"></a>00493          <span class="comment">! Eqn (9) of T&amp;N (2006).</span>
<a name="l00494"></a>00494          dmm(0) = - sqrt( (2d0*el-1d0) / <span class="keywordtype">real(2d0*el,dp)</span> ) 
<a name="l00495"></a>00495               * dl(el-1,0)
<a name="l00496"></a>00496 
<a name="l00497"></a>00497          <span class="comment">! Eqn (10) of T&amp;N (2006).</span>
<a name="l00498"></a>00498          <span class="keyword">do</span> mm = 1, el
<a name="l00499"></a>00499             dmm(mm) = sqrt( el/2d0 * (2d0*el-1d0) / <span class="keywordtype">real((el+mm)</span> * (el+mm-1), dp) ) 
<a name="l00500"></a>00500                  * dl(el-1,mm-1)
<a name="l00501"></a>00501          <span class="keyword">end do</span>
<a name="l00502"></a>00502 
<a name="l00503"></a>00503          dl(el,0:el) = dmm(0:el)
<a name="l00504"></a>00504 
<a name="l00505"></a>00505          <span class="comment">! Eqn (11) of T&amp;N (2006).</span>
<a name="l00506"></a>00506          <span class="keyword">do</span> mm = 0, el
<a name="l00507"></a>00507 
<a name="l00508"></a>00508             <span class="comment">! m = el - 1 case (t2 = 0). </span>
<a name="l00509"></a>00509             m = el-1
<a name="l00510"></a>00510             t1 = ( 2e0 * mm / sqrt(<span class="keywordtype">real((el-m)</span> * (el+m+1), dp)) ) * 
<a name="l00511"></a>00511                  dl(m+1,mm)
<a name="l00512"></a>00512             dl(m,mm) = t1
<a name="l00513"></a>00513 
<a name="l00514"></a>00514             <span class="comment">! Remaining m cases.</span>
<a name="l00515"></a>00515             <span class="keyword">do</span> m = el-2, mm, -1
<a name="l00516"></a>00516                t1 = ( 2e0 * mm / sqrt(<span class="keywordtype">real((el-m)</span> * (el+m+1), dp)) ) * 
<a name="l00517"></a>00517                     dl(m+1,mm)
<a name="l00518"></a>00518                t2 = sqrt( (el-m-1) * (el+m+2) / <span class="keywordtype">real((el-m)</span> * (el+m+1), dp) ) * 
<a name="l00519"></a>00519                     dl(m+2,mm)
<a name="l00520"></a>00520                dl(m,mm) = t1 - t2
<a name="l00521"></a>00521             <span class="keyword">end do</span>
<a name="l00522"></a>00522          <span class="keyword">end do</span>
<a name="l00523"></a>00523 
<a name="l00524"></a>00524       <span class="keyword">end if</span>
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_eighth</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00530"></a>00530     <span class="comment">! ssht_dl_halfpi_trapani_eighth_table</span>
<a name="l00531"></a>00531     <span class="comment">!</span>
<a name="l00549"></a>00549 
<a name="l00550"></a><a class="code" href="namespacessht__dl__mod.html#a686f1baf763676c1cd74c7f654646cb8">00550</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a686f1baf763676c1cd74c7f654646cb8">ssht_dl_halfpi_trapani_eighth_table</a>(dl, el, sqrt_tbl)
<a name="l00551"></a>00551 
<a name="l00552"></a>00552       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00553"></a>00553       <span class="keywordtype">real(dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(0:el,0:el)
<a name="l00554"></a>00554       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: sqrt_tbl(0:2*el+1)
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 
<a name="l00557"></a>00557       <span class="keywordtype">real(dp) </span>:: dmm(0:el)
<a name="l00558"></a>00558       <span class="keywordtype">integer</span> :: m, mm
<a name="l00559"></a>00559       <span class="keywordtype">real(dp) </span>:: t1, t2
<a name="l00560"></a>00560 
<a name="l00561"></a>00561       <span class="keyword">if</span> (el == 0) <span class="keyword">then</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563          dl(0,0) = 1d0
<a name="l00564"></a>00564 
<a name="l00565"></a>00565       <span class="keyword">else</span>
<a name="l00566"></a>00566 
<a name="l00567"></a>00567          <span class="comment">! Eqn (9) of T&amp;N (2006).</span>
<a name="l00568"></a>00568          dmm(0) = - sqrt_tbl(2*el-1) / sqrt_tbl(2*el) &amp;
<a name="l00569"></a>00569               * dl(el-1,0)
<a name="l00570"></a>00570 
<a name="l00571"></a>00571          <span class="comment">! Eqn (10) of T&amp;N (2006).</span>
<a name="l00572"></a>00572          <span class="keyword">do</span> mm = 1, el
<a name="l00573"></a>00573             dmm(mm) = sqrt_tbl(el) / <a class="code" href="namespacessht__types__mod.html#a6b2dcb50b321b331dee639ea562e4622">SQRT2</a> &amp;
<a name="l00574"></a>00574                  * sqrt_tbl(2*el-1) / sqrt_tbl(el+mm) / sqrt_tbl(el+mm-1) &amp;
<a name="l00575"></a>00575                  * dl(el-1,mm-1)
<a name="l00576"></a>00576          <span class="keyword">end do</span>
<a name="l00577"></a>00577 
<a name="l00578"></a>00578          dl(el,0:el) = dmm(0:el)
<a name="l00579"></a>00579 
<a name="l00580"></a>00580          <span class="comment">! Eqn (11) of T&amp;N (2006).</span>
<a name="l00581"></a>00581          <span class="keyword">do</span> mm = 0, el
<a name="l00582"></a>00582 
<a name="l00583"></a>00583             <span class="comment">! m = el-1 case (t2 = 0). </span>
<a name="l00584"></a>00584             m = el-1
<a name="l00585"></a>00585             dl(m,mm) = 2e0 * mm / sqrt_tbl(el-m) / sqrt_tbl(el+m+1) &amp;
<a name="l00586"></a>00586                  * dl(m+1,mm)
<a name="l00587"></a>00587 
<a name="l00588"></a>00588             <span class="comment">! Remaining m cases.</span>
<a name="l00589"></a>00589             <span class="keyword">do</span> m = el-2, mm, -1
<a name="l00590"></a>00590                t1 = 2e0 * mm / sqrt_tbl(el-m) / sqrt_tbl(el+m+1) &amp;
<a name="l00591"></a>00591                     * dl(m+1,mm)
<a name="l00592"></a>00592                t2 = sqrt_tbl(el-m-1) * sqrt_tbl(el+m+2) / sqrt_tbl(el-m) / sqrt_tbl(el+m+1) &amp;
<a name="l00593"></a>00593                     * dl(m+2,mm)
<a name="l00594"></a>00594                dl(m,mm) = t1 - t2
<a name="l00595"></a>00595             <span class="keyword">end do</span>
<a name="l00596"></a>00596          <span class="keyword">end do</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598       <span class="keyword">end if</span>
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_eighth_table</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00604"></a>00604     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2full</span>
<a name="l00605"></a>00605     <span class="comment">!</span>
<a name="l00618"></a>00618  
<a name="l00619"></a><a class="code" href="namespacessht__dl__mod.html#ad015dc242ed6e09f8ebe8ed7353ee137">00619</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#ad015dc242ed6e09f8ebe8ed7353ee137">ssht_dl_halfpi_trapani_fill_eighth2full</a>(dl, el)
<a name="l00620"></a>00620 
<a name="l00621"></a>00621       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00622"></a>00622       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-el:el,-el:el)
<a name="l00623"></a>00623 
<a name="l00624"></a>00624       <span class="keywordtype">integer</span> :: m, mm
<a name="l00625"></a>00625 
<a name="l00626"></a>00626       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00627"></a>00627       <span class="keyword">do</span> m = 0, el
<a name="l00628"></a>00628          <span class="keyword">do</span> mm = m+1, el
<a name="l00629"></a>00629             dl(m,mm) = (-1)**(m+mm) * dl(mm,m)
<a name="l00630"></a>00630          <span class="keyword">end do</span>
<a name="l00631"></a>00631       <span class="keyword">end do</span>
<a name="l00632"></a>00632 
<a name="l00633"></a>00633       <span class="comment">! Symmetry in m to fill in half.</span>
<a name="l00634"></a>00634       <span class="keyword">do</span> mm = 0, el
<a name="l00635"></a>00635          <span class="keyword">do</span> m = -el, -1
<a name="l00636"></a>00636             dl(m,mm) = (-1)**(el+mm) * dl(-m,mm)
<a name="l00637"></a>00637          <span class="keyword">end do</span>
<a name="l00638"></a>00638       <span class="keyword">end do</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640       <span class="comment">! Symmetry in mm to fill in remaining plane.</span>
<a name="l00641"></a>00641       <span class="keyword">do</span> mm = -el, -1
<a name="l00642"></a>00642          <span class="keyword">do</span> m = -el, el
<a name="l00643"></a>00643             dl(m,mm) = (-1)**(el+m) * dl(m,-mm)
<a name="l00644"></a>00644          <span class="keyword">end do</span>
<a name="l00645"></a>00645       <span class="keyword">end do</span>
<a name="l00646"></a>00646 
<a name="l00647"></a>00647 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2full</span>
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00651"></a>00651     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2full_table</span>
<a name="l00652"></a>00652     <span class="comment">!</span>
<a name="l00667"></a>00667  
<a name="l00668"></a><a class="code" href="namespacessht__dl__mod.html#adfc0c434c2a7b054b5707eb356aabcf2">00668</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#adfc0c434c2a7b054b5707eb356aabcf2">ssht_dl_halfpi_trapani_fill_eighth2full_table</a>(dl, el, signs)
<a name="l00669"></a>00669 
<a name="l00670"></a>00670       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00671"></a>00671       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-el:el,-el:el)
<a name="l00672"></a>00672       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: signs(0:el)
<a name="l00673"></a>00673 
<a name="l00674"></a>00674       <span class="keywordtype">integer</span> :: m, mm
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00677"></a>00677       <span class="keyword">do</span> m = 0, el
<a name="l00678"></a>00678          <span class="keyword">do</span> mm = m+1, el
<a name="l00679"></a>00679             dl(m,mm) = signs(m) * signs(mm) * dl(mm,m)
<a name="l00680"></a>00680          <span class="keyword">end do</span>
<a name="l00681"></a>00681       <span class="keyword">end do</span>
<a name="l00682"></a>00682 
<a name="l00683"></a>00683       <span class="comment">! Symmetry in m to fill in half.</span>
<a name="l00684"></a>00684       <span class="keyword">do</span> mm = 0, el
<a name="l00685"></a>00685          <span class="keyword">do</span> m = -el, -1
<a name="l00686"></a>00686             dl(m,mm) = signs(el) * signs(mm) * dl(-m,mm)
<a name="l00687"></a>00687          <span class="keyword">end do</span>
<a name="l00688"></a>00688       <span class="keyword">end do</span>
<a name="l00689"></a>00689 
<a name="l00690"></a>00690       <span class="comment">! Symmetry in mm to fill in remaining plane.</span>
<a name="l00691"></a>00691       <span class="keyword">do</span> mm = -el, -1
<a name="l00692"></a>00692          <span class="keyword">do</span> m = -el, el
<a name="l00693"></a>00693             dl(m,mm) = signs(el) * signs(abs(m)) * dl(m,-mm)
<a name="l00694"></a>00694          <span class="keyword">end do</span>
<a name="l00695"></a>00695       <span class="keyword">end do</span>
<a name="l00696"></a>00696 
<a name="l00697"></a>00697 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2full_table</span>
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 
<a name="l00700"></a>00700     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00701"></a>00701     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2tophalf</span>
<a name="l00702"></a>00702     <span class="comment">!</span>
<a name="l00715"></a>00715  
<a name="l00716"></a><a class="code" href="namespacessht__dl__mod.html#a55d35ee6e482d64090ea74f7f94c81ac">00716</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a55d35ee6e482d64090ea74f7f94c81ac">ssht_dl_halfpi_trapani_fill_eighth2tophalf</a>(dl, el)
<a name="l00717"></a>00717 
<a name="l00718"></a>00718       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00719"></a>00719       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-el:el,0:el)
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       <span class="keywordtype">integer</span> :: m, mm
<a name="l00722"></a>00722 
<a name="l00723"></a>00723       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00724"></a>00724       <span class="keyword">do</span> m = 0, el
<a name="l00725"></a>00725          <span class="keyword">do</span> mm = m+1, el
<a name="l00726"></a>00726             dl(m,mm) = (-1)**(m+mm) * dl(mm,m)
<a name="l00727"></a>00727          <span class="keyword">end do</span>
<a name="l00728"></a>00728       <span class="keyword">end do</span>
<a name="l00729"></a>00729 
<a name="l00730"></a>00730       <span class="comment">! Symmetry in m to fill in half.</span>
<a name="l00731"></a>00731       <span class="keyword">do</span> m = -el, -1
<a name="l00732"></a>00732          <span class="keyword">do</span> mm = 0, el
<a name="l00733"></a>00733             dl(m,mm) = (-1)**(el+mm) * dl(-m,mm)
<a name="l00734"></a>00734          <span class="keyword">end do</span>
<a name="l00735"></a>00735       <span class="keyword">end do</span>
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2tophalf</span>
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00741"></a>00741     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2tophalf_table</span>
<a name="l00742"></a>00742     <span class="comment">!</span>
<a name="l00757"></a>00757  
<a name="l00758"></a><a class="code" href="namespacessht__dl__mod.html#a3a71d3e987f807132a8a57978b5f4852">00758</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a3a71d3e987f807132a8a57978b5f4852">ssht_dl_halfpi_trapani_fill_eighth2tophalf_table</a>(dl, el, signs)
<a name="l00759"></a>00759 
<a name="l00760"></a>00760       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00761"></a>00761       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-el:el,0:el)
<a name="l00762"></a>00762       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: signs(0:el)
<a name="l00763"></a>00763 
<a name="l00764"></a>00764       <span class="keywordtype">integer</span> :: m, mm
<a name="l00765"></a>00765 
<a name="l00766"></a>00766       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00767"></a>00767       <span class="keyword">do</span> m = 0, el
<a name="l00768"></a>00768          <span class="keyword">do</span> mm = m+1, el
<a name="l00769"></a>00769             dl(m,mm) = signs(m) * signs(mm) * dl(mm,m)
<a name="l00770"></a>00770          <span class="keyword">end do</span>
<a name="l00771"></a>00771       <span class="keyword">end do</span>
<a name="l00772"></a>00772 
<a name="l00773"></a>00773       <span class="comment">! Symmetry in m to fill in half.</span>
<a name="l00774"></a>00774       <span class="keyword">do</span> mm = 0, el
<a name="l00775"></a>00775          <span class="keyword">do</span> m = -el, -1
<a name="l00776"></a>00776             dl(m,mm) = signs(el) * signs(mm) * dl(-m,mm)
<a name="l00777"></a>00777          <span class="keyword">end do</span>
<a name="l00778"></a>00778       <span class="keyword">end do</span>
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2tophalf_table</span>
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00784"></a>00784     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2righthalf</span>
<a name="l00785"></a>00785     <span class="comment">!</span>
<a name="l00798"></a>00798  
<a name="l00799"></a><a class="code" href="namespacessht__dl__mod.html#a025eb6f5d17b61151b059744cbf08f82">00799</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a025eb6f5d17b61151b059744cbf08f82">ssht_dl_halfpi_trapani_fill_eighth2righthalf</a>(dl, el)
<a name="l00800"></a>00800 
<a name="l00801"></a>00801       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00802"></a>00802       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(0:el,-el:el)
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <span class="keywordtype">integer</span> :: m, mm
<a name="l00805"></a>00805 
<a name="l00806"></a>00806       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00807"></a>00807       <span class="keyword">do</span> m = 0, el
<a name="l00808"></a>00808          <span class="keyword">do</span> mm = m+1, el
<a name="l00809"></a>00809             dl(m,mm) = (-1)**(m+mm) * dl(mm,m)
<a name="l00810"></a>00810          <span class="keyword">end do</span>
<a name="l00811"></a>00811       <span class="keyword">end do</span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813       <span class="comment">! Symmetry in mm to fill in half.</span>
<a name="l00814"></a>00814       <span class="keyword">do</span> m = 0, el
<a name="l00815"></a>00815          <span class="keyword">do</span> mm = -el, -1
<a name="l00816"></a>00816             dl(m,mm) = (-1)**(el+m) * dl(m,-mm)
<a name="l00817"></a>00817          <span class="keyword">end do</span>
<a name="l00818"></a>00818       <span class="keyword">end do</span>
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2righthalf</span>
<a name="l00821"></a>00821 
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00824"></a>00824     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2righthalf_table</span>
<a name="l00825"></a>00825     <span class="comment">!</span>
<a name="l00840"></a>00840  
<a name="l00841"></a><a class="code" href="namespacessht__dl__mod.html#a1649263883d2c81c5d2e0a1dfb40361e">00841</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a1649263883d2c81c5d2e0a1dfb40361e">ssht_dl_halfpi_trapani_fill_eighth2righthalf_table</a>(dl, el, signs)
<a name="l00842"></a>00842 
<a name="l00843"></a>00843       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00844"></a>00844       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(0:el,-el:el)
<a name="l00845"></a>00845       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: signs(0:el)
<a name="l00846"></a>00846 
<a name="l00847"></a>00847       <span class="keywordtype">integer</span> :: m, mm
<a name="l00848"></a>00848 
<a name="l00849"></a>00849       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00850"></a>00850       <span class="keyword">do</span> m = 0, el
<a name="l00851"></a>00851          <span class="keyword">do</span> mm = m+1, el
<a name="l00852"></a>00852             dl(m,mm) = signs(m) * signs(mm) * dl(mm,m)
<a name="l00853"></a>00853          <span class="keyword">end do</span>
<a name="l00854"></a>00854       <span class="keyword">end do</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856       <span class="comment">! Symmetry in mm to fill in half.</span>
<a name="l00857"></a>00857       <span class="keyword">do</span> mm = -el, -1
<a name="l00858"></a>00858          <span class="keyword">do</span> m = 0, el
<a name="l00859"></a>00859             dl(m,mm) = signs(el) * signs(m) * dl(m,-mm)
<a name="l00860"></a>00860          <span class="keyword">end do</span>
<a name="l00861"></a>00861       <span class="keyword">end do</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2righthalf_table</span>
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 
<a name="l00866"></a>00866     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00867"></a>00867     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2quarter</span>
<a name="l00868"></a>00868     <span class="comment">!</span>
<a name="l00881"></a>00881 
<a name="l00882"></a><a class="code" href="namespacessht__dl__mod.html#a4d4bd52c8600abece770cb172fb6788a">00882</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a4d4bd52c8600abece770cb172fb6788a">ssht_dl_halfpi_trapani_fill_eighth2quarter</a>(dl, el)
<a name="l00883"></a>00883 
<a name="l00884"></a>00884       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00885"></a>00885       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(0:el,0:el)
<a name="l00886"></a>00886 
<a name="l00887"></a>00887       <span class="keywordtype">integer</span> :: m, mm
<a name="l00888"></a>00888 
<a name="l00889"></a>00889       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00890"></a>00890       <span class="keyword">do</span> m = 0, el
<a name="l00891"></a>00891          <span class="keyword">do</span> mm = m+1, el
<a name="l00892"></a>00892             dl(m,mm) = (-1)**(m+mm) * dl(mm,m)
<a name="l00893"></a>00893          <span class="keyword">end do</span>
<a name="l00894"></a>00894       <span class="keyword">end do</span>
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2quarter</span>
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00900"></a>00900     <span class="comment">! ssht_dl_halfpi_trapani_fill_eighth2quarter_table</span>
<a name="l00901"></a>00901     <span class="comment">!</span>
<a name="l00916"></a>00916 
<a name="l00917"></a><a class="code" href="namespacessht__dl__mod.html#adc8f56f6411b454152d8649e8b67e023">00917</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#adc8f56f6411b454152d8649e8b67e023">ssht_dl_halfpi_trapani_fill_eighth2quarter_table</a>(dl, el, signs)
<a name="l00918"></a>00918 
<a name="l00919"></a>00919       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: el
<a name="l00920"></a>00920       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(0:el,0:el)
<a name="l00921"></a>00921       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: signs(0:el)
<a name="l00922"></a>00922 
<a name="l00923"></a>00923       <span class="keywordtype">integer</span> :: m, mm
<a name="l00924"></a>00924 
<a name="l00925"></a>00925       <span class="comment">! Diagonal symmetry to fill in quarter.</span>
<a name="l00926"></a>00926       <span class="keyword">do</span> m = 0, el
<a name="l00927"></a>00927          <span class="keyword">do</span> mm = m+1, el
<a name="l00928"></a>00928             dl(m,mm) = signs(m) * signs(mm) * dl(mm,m)
<a name="l00929"></a>00929          <span class="keyword">end do</span>
<a name="l00930"></a>00930       <span class="keyword">end do</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 <span class="keyword">    end subroutine ssht_dl_halfpi_trapani_fill_eighth2quarter_table</span>
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00936"></a>00936     <span class="comment">! Operator method</span>
<a name="l00937"></a>00937     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00940"></a>00940     <span class="comment">! ssht_dl_beta_operator</span>
<a name="l00941"></a>00941     <span class="comment">!</span>
<a name="l00956"></a>00956     
<a name="l00957"></a><a class="code" href="namespacessht__dl__mod.html#aa0d2c93c3a04508c4063fa125655a060">00957</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#aa0d2c93c3a04508c4063fa125655a060">ssht_dl_beta_operator</a>(dl, beta, l)
<a name="l00958"></a>00958 
<a name="l00959"></a>00959       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l00960"></a>00960       <span class="keywordtype">real(dp)</span>, <span class="keywordtype">intent(out)</span> :: dl(-l:l,-l:l)
<a name="l00961"></a>00961       <span class="keywordtype">real(dp)</span>, <span class="keywordtype">intent(in)</span> :: beta
<a name="l00962"></a>00962   
<a name="l00963"></a>00963       <span class="comment">! Fill in the top quarter of the d-matrix.</span>
<a name="l00964"></a>00964       call <a class="code" href="namespacessht__dl__mod.html#a2ecf3fb1828f79db08139f9d3f8a3dc2">ssht_dl_beta_operator_quarter</a>(dl(-l:l,-l:l), beta, l)
<a name="l00965"></a>00965   
<a name="l00966"></a>00966       <span class="comment">! Use its symmetry properties to fill in the rest of it.</span>
<a name="l00967"></a>00967       call <a class="code" href="namespacessht__dl__mod.html#ad65fbf71b01d5991a2b1f7c997960f99">ssht_dl_beta_operator_fill</a>(dl(-l:l,-l:l), l)
<a name="l00968"></a>00968   
<a name="l00969"></a>00969 <span class="keyword">    end subroutine ssht_dl_beta_operator</span>
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l00973"></a>00973     <span class="comment">! ssht_dl_beta_operator_quarter</span>
<a name="l00974"></a>00974     <span class="comment">!</span>
<a name="l00992"></a>00992 
<a name="l00993"></a><a class="code" href="namespacessht__dl__mod.html#a2ecf3fb1828f79db08139f9d3f8a3dc2">00993</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#a2ecf3fb1828f79db08139f9d3f8a3dc2">ssht_dl_beta_operator_quarter</a>(dl, beta, l)
<a name="l00994"></a>00994 
<a name="l00995"></a>00995       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l00996"></a>00996       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(out)</span> :: dl(-l:l,-l:l)
<a name="l00997"></a>00997       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(in)</span> :: beta
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   
<a name="l01000"></a>01000       <span class="keywordtype">real(kind = dp) </span>:: lambda, xllp1, xm, big, bigi, bigi2, c, s, omc, 
<a name="l01001"></a>01001         lbig, expo, renorm, ratio, c2, t, si, ang, big_const
<a name="l01002"></a>01002       <span class="keywordtype">real(kind = dp) </span>:: cp(1:2 * l + 1)
<a name="l01003"></a>01003       <span class="keywordtype">real(kind = dp) </span>:: cpi(1:2 * l + 1)
<a name="l01004"></a>01004       <span class="keywordtype">real(kind = dp) </span>:: cp2(1:2 * l + 1)
<a name="l01005"></a>01005       <span class="keywordtype">real(kind = dp) </span>:: log_first_row(1:2 * l + 1)
<a name="l01006"></a>01006       <span class="keywordtype">real(kind = dp) </span>:: sign(1:2 * l + 1)
<a name="l01007"></a>01007       <span class="keywordtype">real(kind = dp) </span>:: lrenorm(1:2 * l + 1)
<a name="l01008"></a>01008 
<a name="l01009"></a>01009       <span class="keywordtype">integer</span> :: index, i, m, im, j, lp1
<a name="l01010"></a>01010   
<a name="l01011"></a>01011       <span class="comment">! Added by Jason McEwen 19/11/05</span>
<a name="l01012"></a>01012       <span class="comment">! If beta=0 then dl=identity</span>
<a name="l01013"></a>01013       <span class="keywordtype">real(kind = dp) </span>:: ZERO_TOL = 1d-5
<a name="l01014"></a>01014       <span class="keyword">if</span>(abs(beta) &lt; ZERO_TOL) <span class="keyword">then</span>
<a name="l01015"></a>01015         dl(-l:l,-l:l) = 0d0
<a name="l01016"></a>01016         <span class="keyword">do</span> i = -l,l
<a name="l01017"></a>01017           dl(i,i) = 1d0
<a name="l01018"></a>01018         <span class="keyword">end do</span>
<a name="l01019"></a>01019         return      <span class="comment">! ** Exit routine</span>
<a name="l01020"></a>01020       <span class="keyword">end if</span>
<a name="l01021"></a>01021   
<a name="l01022"></a>01022       lp1 = l + 1
<a name="l01023"></a>01023       big_const = 1.0d150
<a name="l01024"></a>01024 
<a name="l01025"></a>01025       ang=beta
<a name="l01026"></a>01026       c=dcos(ang)
<a name="l01027"></a>01027       s=dsin(ang)
<a name="l01028"></a>01028       si=1.d0/s
<a name="l01029"></a>01029       t=dtan(-ang/2.d0)
<a name="l01030"></a>01030       c2=dcos(ang/2.d0)
<a name="l01031"></a>01031       omc=1.d0-c
<a name="l01032"></a>01032   
<a name="l01033"></a>01033       <span class="keyword">do</span> i=1,2*l+1
<a name="l01034"></a>01034         lrenorm(i)=0.d0
<a name="l01035"></a>01035       <span class="keyword">end do</span>
<a name="l01036"></a>01036   
<a name="l01037"></a>01037       <span class="comment">! Compute first row.</span>
<a name="l01038"></a>01038   
<a name="l01039"></a>01039       log_first_row(1)=(2.d0*<span class="keywordtype">real</span>(l,kind=dp))*dlog(dabs(c2))
<a name="l01040"></a>01040       sign(1)=1.d0
<a name="l01041"></a>01041       <span class="keyword">do</span> i=2, 2*l+1
<a name="l01042"></a>01042         m=l+1-i
<a name="l01043"></a>01043         ratio=dsqrt(<span class="keywordtype">real</span>(l+m+1,kind=dp)/<span class="keywordtype">real</span>(l-m,kind=dp))
<a name="l01044"></a>01044         log_first_row(i)=log_first_row(i-1) &amp;
<a name="l01045"></a>01045           +dlog(ratio)+dlog(dabs(t))
<a name="l01046"></a>01046         sign(i)=sign(i-1)*t/dabs(t)
<a name="l01047"></a>01047       <span class="keyword">end do</span>
<a name="l01048"></a>01048   
<a name="l01049"></a>01049       big=big_const
<a name="l01050"></a>01050       lbig=dlog(big)
<a name="l01051"></a>01051       bigi=1.d0/big_const
<a name="l01052"></a>01052       bigi2=1.d0/big_const**2
<a name="l01053"></a>01053       xllp1=<span class="keywordtype">real(l*(l+1)</span>,kind=dp)
<a name="l01054"></a>01054   
<a name="l01055"></a>01055       <span class="comment">! Initialising coefficients cp(m)= cplus(l-m).</span>
<a name="l01056"></a>01056   
<a name="l01057"></a>01057       <span class="keyword">do</span> m=1,l
<a name="l01058"></a>01058         xm=<span class="keywordtype">real</span>(l-m,kind=dp)
<a name="l01059"></a>01059         cpi(m)=2.d0/dsqrt(xllp1-xm*(xm+1))
<a name="l01060"></a>01060         cp(m)=1.d0/cpi(m)
<a name="l01061"></a>01061       <span class="keyword">end do</span>
<a name="l01062"></a>01062       <span class="keyword">do</span> m=2,l
<a name="l01063"></a>01063         cp2(m)=cpi(m)*cp(m-1)
<a name="l01064"></a>01064       <span class="keyword">end do</span>
<a name="l01065"></a>01065       dl(1 - lp1, 1 - lp1)=1.d0
<a name="l01066"></a>01066       dl(2*l+1 - lp1, 1 - lp1)=1.d0
<a name="l01067"></a>01067   
<a name="l01068"></a>01068       <span class="comment">! Use recurrrence relation to fill columns down to diagonals.</span>
<a name="l01069"></a>01069   
<a name="l01070"></a>01070       <span class="keyword">do</span> index= 2,l+1
<a name="l01071"></a>01071         dl(index - lp1, 1 - lp1)=1.d0
<a name="l01072"></a>01072         lambda=(<span class="keywordtype">real</span>(l+1,kind=dp)*omc-<span class="keywordtype">real</span>(index,kind=dp)+c)*si
<a name="l01073"></a>01073         dl(index - lp1, 2 - lp1)=lambda*dl(index - lp1, 1 - lp1)*cpi(1)
<a name="l01074"></a>01074         <span class="keyword">if</span>(index.gt.2) <span class="keyword">then</span>
<a name="l01075"></a>01075           <span class="keyword">do</span> m=2,index-1
<a name="l01076"></a>01076             lambda=(<span class="keywordtype">real</span>(l+1,kind=dp)*omc 
<a name="l01077"></a>01077               -<span class="keywordtype">real</span>(index,kind=dp)+<span class="keywordtype">real</span>(m,kind=dp)*c)/s
<a name="l01078"></a>01078             dl(index - lp1, m+1 - lp1)= &amp;
<a name="l01079"></a>01079               lambda*cpi(m)*dl(index - lp1, m - lp1)-cp2(m) &amp;
<a name="l01080"></a>01080               *dl(index - lp1, m-1 - lp1)
<a name="l01081"></a>01081             <span class="keyword">if</span>(dl(index - lp1, m+1 - lp1).gt.big) <span class="keyword">then</span>
<a name="l01082"></a>01082               lrenorm(index)=lrenorm(index)-lbig
<a name="l01083"></a>01083               <span class="keyword">do</span> im=1,m+1
<a name="l01084"></a>01084                 dl(index - lp1, im - lp1)=dl(index - lp1, im - lp1)*bigi
<a name="l01085"></a>01085               <span class="keyword">end do</span>
<a name="l01086"></a>01086             <span class="keyword">end if</span>
<a name="l01087"></a>01087           <span class="keyword">end do</span>
<a name="l01088"></a>01088         <span class="keyword">end if</span>
<a name="l01089"></a>01089       <span class="keyword">end do</span>   
<a name="l01090"></a>01090   
<a name="l01091"></a>01091       <span class="comment">! Other half of triangle.</span>
<a name="l01092"></a>01092   
<a name="l01093"></a>01093       <span class="keyword">do</span> index= l+2,2*l
<a name="l01094"></a>01094         dl(index - lp1, 1 - lp1)=1.d0
<a name="l01095"></a>01095         lambda=(<span class="keywordtype">real</span>(l+1,kind=dp)*omc-<span class="keywordtype">real</span>(index,kind=dp)+c)/s
<a name="l01096"></a>01096         dl(index - lp1, 2 - lp1)=lambda*dl(index - lp1, 1 - lp1)*cpi(1)
<a name="l01097"></a>01097         <span class="keyword">if</span>(index.lt.2*l) <span class="keyword">then</span>
<a name="l01098"></a>01098           <span class="keyword">do</span> m=2,2*l-index+1
<a name="l01099"></a>01099             lambda=(<span class="keywordtype">real</span>(l+1,kind=dp)*omc-<span class="keywordtype">real(index,kind=dp)</span> 
<a name="l01100"></a>01100               +<span class="keywordtype">real</span>(m,kind=dp)*c)/s
<a name="l01101"></a>01101             dl(index - lp1, m+1 - lp1)= &amp;
<a name="l01102"></a>01102               lambda*cpi(m)*dl(index - lp1, m - lp1)-cp2(m)&amp;
<a name="l01103"></a>01103               *dl(index - lp1, m-1 - lp1)
<a name="l01104"></a>01104             <span class="keyword">if</span>(dl(index - lp1, m+1 - lp1).gt.big) <span class="keyword">then</span>
<a name="l01105"></a>01105               <span class="keyword">do</span> im=1,m+1
<a name="l01106"></a>01106                 dl(index - lp1, im - lp1)=dl(index - lp1, im - lp1)*bigi
<a name="l01107"></a>01107               <span class="keyword">end do</span>
<a name="l01108"></a>01108               lrenorm(index)=lrenorm(index)-lbig
<a name="l01109"></a>01109             <span class="keyword">end if</span>
<a name="l01110"></a>01110           <span class="keyword">end do</span>
<a name="l01111"></a>01111         <span class="keyword">end if</span>
<a name="l01112"></a>01112       <span class="keyword">end do</span>   
<a name="l01113"></a>01113   
<a name="l01114"></a>01114       <span class="keyword">do</span> i=1, l+1
<a name="l01115"></a>01115         renorm=sign(i)*dexp(log_first_row(i)-lrenorm(i))
<a name="l01116"></a>01116         <span class="keyword">do</span> j=1, i
<a name="l01117"></a>01117           dl(i - lp1, j - lp1)= dl(i - lp1, j - lp1)*renorm
<a name="l01118"></a>01118         <span class="keyword">end do</span>
<a name="l01119"></a>01119       <span class="keyword">end do</span>
<a name="l01120"></a>01120       <span class="keyword">do</span> i=l+2,2*l+1
<a name="l01121"></a>01121         expo=log_first_row(i)-lrenorm(i)
<a name="l01122"></a>01122         renorm=sign(i)*dexp(log_first_row(i)-lrenorm(i))
<a name="l01123"></a>01123         <span class="keyword">do</span> j=1,2*l+2-i
<a name="l01124"></a>01124           dl(i - lp1, j - lp1)=dl(i - lp1, j - lp1)*renorm
<a name="l01125"></a>01125         <span class="keyword">end do</span>
<a name="l01126"></a>01126       <span class="keyword">end do</span>
<a name="l01127"></a>01127   
<a name="l01128"></a>01128 <span class="keyword">    end subroutine ssht_dl_beta_operator_quarter</span>
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     
<a name="l01131"></a>01131     <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l01132"></a>01132     <span class="comment">! ssht_dl_beta_operator_fill</span>
<a name="l01133"></a>01133     <span class="comment">!</span>
<a name="l01147"></a>01147 
<a name="l01148"></a><a class="code" href="namespacessht__dl__mod.html#ad65fbf71b01d5991a2b1f7c997960f99">01148</a>     <span class="keyword">subroutine </span><a class="code" href="namespacessht__dl__mod.html#ad65fbf71b01d5991a2b1f7c997960f99">ssht_dl_beta_operator_fill</a>(dl, l)
<a name="l01149"></a>01149 
<a name="l01150"></a>01150       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: l
<a name="l01151"></a>01151       <span class="keywordtype">real(kind = dp)</span>, <span class="keywordtype">intent(inout)</span> :: dl(-l:l,-l:l)
<a name="l01152"></a>01152   
<a name="l01153"></a>01153       <span class="keywordtype">integer</span> :: i, j,sgn, lp1
<a name="l01154"></a>01154   
<a name="l01155"></a>01155       lp1 = l + 1
<a name="l01156"></a>01156   
<a name="l01157"></a>01157       <span class="comment">! Reflect across anti-diagonal.</span>
<a name="l01158"></a>01158   
<a name="l01159"></a>01159       <span class="keyword">do</span> i = 1, l
<a name="l01160"></a>01160         <span class="keyword">do</span> j = l + 1, 2 * l + 1 - i
<a name="l01161"></a>01161           dl(2 * l + 2 - i - lp1, 2 * l + 2 - j - lp1) = dl(j - lp1, i - lp1)
<a name="l01162"></a>01162         <span class="keyword">end do</span>
<a name="l01163"></a>01163       <span class="keyword">end do</span>
<a name="l01164"></a>01164   
<a name="l01165"></a>01165       <span class="comment">! Reflect across diagonal.</span>
<a name="l01166"></a>01166   
<a name="l01167"></a>01167       <span class="keyword">do</span> i = 1, l + 1
<a name="l01168"></a>01168         sgn = - 1
<a name="l01169"></a>01169         <span class="keyword">do</span> j = i + 1, l + 1
<a name="l01170"></a>01170           dl(i - lp1, j - lp1) = dl(j - lp1, i - lp1) * sgn
<a name="l01171"></a>01171           sgn = sgn * (- 1)
<a name="l01172"></a>01172         <span class="keyword">end do</span>
<a name="l01173"></a>01173       <span class="keyword">end do</span>
<a name="l01174"></a>01174   
<a name="l01175"></a>01175       <span class="comment">! Fill in right quarter of matrix.</span>
<a name="l01176"></a>01176   
<a name="l01177"></a>01177       <span class="keyword">do</span> i = l + 2, 2 * l + 1
<a name="l01178"></a>01178         sgn = (- 1)**(i + 1)
<a name="l01179"></a>01179         <span class="keyword">do</span> j = 1, 2 * l + 2 - i
<a name="l01180"></a>01180           dl(j - lp1, i - lp1) = dl(i - lp1, j - lp1) * sgn
<a name="l01181"></a>01181           sgn = sgn * (- 1)
<a name="l01182"></a>01182         <span class="keyword">end do</span>
<a name="l01183"></a>01183         <span class="keyword">do</span> j = i, 2 * l + 1
<a name="l01184"></a>01184           dl(j - lp1, i - lp1) = dl(2 * l + 2 - i - lp1, 2 * l + 2 - j - lp1)
<a name="l01185"></a>01185         <span class="keyword">end do</span>
<a name="l01186"></a>01186       <span class="keyword">end do</span>
<a name="l01187"></a>01187   
<a name="l01188"></a>01188       <span class="keyword">do</span> i = l + 2, 2 * l + 1
<a name="l01189"></a>01189         <span class="keyword">do</span> j = 2 * l + 3 - i, i - 1
<a name="l01190"></a>01190           dl(j - lp1, i - lp1) = dl(2 * l + 2 - i - lp1, 2 * l + 2 - j - lp1)
<a name="l01191"></a>01191         <span class="keyword">end do</span>
<a name="l01192"></a>01192       <span class="keyword">end do</span>
<a name="l01193"></a>01193   
<a name="l01194"></a>01194 <span class="keyword">    end subroutine ssht_dl_beta_operator_fill</span>
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 
<a name="l01197"></a>01197 <span class="keyword">end module ssht_dl_mod</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Oct 31 01:20:05 2011 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
